<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro de Testes</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    /* Cores e variáveis para o tema claro fixo */
    :root {
      --primary-color: #007bff; /* Azul primário suave */
      --primary-dark: #0056b3; /* Azul mais escuro para hover */
      --background-gradient: linear-gradient(135deg, #f0f2f5, #e0e4eb); /* Gradiente de cinza/branco suave */
      --card-background: #ffffff;
      --text-color: #343a40; /* Texto quase preto */
      --placeholder-color: #6c757d;
      --border-color: #ced4da;
      --focus-border-color: var(--primary-color);
      --shadow-light: rgba(0, 0, 0, 0.05);
      --shadow-medium: rgba(0, 0, 0, 0.1);
      --success-bg: #d4edda; /* Verde claro */
      --success-border: #28a745;
      --success-text: #155724;
      --failure-bg: #f8d7da; /* Vermelho claro */
      --failure-border: #dc3545;
      --failure-text: #721c24;
      --na-bg: #e9ecef; /* Cinza muito claro */
      --na-border: #adb5bd;
      --na-text: #495057;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Roboto', sans-serif;
    }

    body {
      background: var(--background-gradient);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      color: var(--text-color);
    }

    .app {
      background: var(--card-background);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 8px 25px var(--shadow-medium);
      width: 100%;
      max-width: 650px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      position: relative;
    }

    h1 {
      text-align: center;
      font-size: 2rem;
      color: var(--primary-color);
      margin-bottom: 10px;
      font-weight: 700;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    label {
      font-weight: 500;
      color: var(--text-color);
      font-size: 0.95rem;
    }

    select,
    input[type="text"] {
      padding: 12px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      color: var(--text-color);
      background-color: var(--card-background);
      box-shadow: inset 0 1px 2px var(--shadow-light);
    }

    select::placeholder,
    input[type="text"]::placeholder {
      color: var(--placeholder-color);
    }

    select:focus,
    input[type="text"]:focus {
      border-color: var(--focus-border-color);
      box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
      outline: none;
    }

    fieldset {
      border: none;
      padding: 0;
      margin-top: 10px;
    }

    legend {
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--text-color);
      font-size: 1rem;
    }

    .components {
      display: grid;
      grid-template-columns: repeat(2, 1fr); /* Sempre duas colunas */
      gap: 12px; /* Aumentado um pouco o gap para botões maiores */
    }

    .component {
      background: var(--na-bg);
      padding: 20px 15px; /* Aumentado o padding para um aspecto mais quadrado e maior */
      border-radius: 12px; /* Borda um pouco mais arredondada */
      box-shadow: 0 4px 10px var(--shadow-light); /* Sombra mais visível */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      transition: background 0.2s ease, box-shadow 0.2s ease, transform 0.1s ease, border-color 0.3s ease; /* Adicionado transição para border-color */
      border: 1px solid var(--na-border);
      min-height: 90px; /* Aumentar a altura mínima para garantir que seja mais quadrado */
      text-align: center;
    }

    .component:hover {
      box-shadow: 0 6px 15px var(--shadow-medium); /* Sombra ao passar o mouse mais intensa */
    }

    .component:active {
      transform: scale(0.95);
    }

    .component .icon {
      font-size: 2.2rem; /* Ícone um pouco maior */
      margin-bottom: 5px; /* Ajuste o espaço entre o ícone e o texto */
      line-height: 1;
      transition: transform 0.3s ease, color 0.3s ease; /* Transição para animação e cor */
    }

    .component span {
      font-weight: 500;
      font-size: 1rem; /* Texto do componente maior */
      color: var(--na-text);
      pointer-events: none;
    }

    /* Estados dos Componentes */
    .status-na {
      background-color: var(--na-bg);
      border-color: var(--na-border);
    }
    .status-na span { color: var(--na-text); }
    .status-na .icon { color: var(--na-text); } /* Cor cinza para N/A */

    .status-ok {
      background-color: var(--success-bg);
      border-color: var(--success-border);
    }
    .status-ok span { color: var(--success-text); }
    .status-ok .icon { 
      color: var(--success-border); 
      animation: pulseGreen 0.6s ease-out; /* Animação para OK */
    }

    .status-falha {
      background-color: var(--failure-bg);
      border-color: var(--failure-border);
    }
    .status-falha span { color: var(--failure-text); }
    .status-falha .icon { 
      color: var(--failure-border); 
      animation: shakeRed 0.6s ease-out; /* Animação para FALHA */
    }

    /* Animações dos ícones */
    @keyframes pulseGreen {
      0% { transform: scale(0.8); opacity: 0.7; }
      50% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes shakeRed {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-5px); }
      40%, 80% { transform: translateX(5px); }
    }


    button[type="submit"] {
      padding: 14px;
      background: var(--primary-color);
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
      margin-top: 15px;
      box-shadow: 0 4px 10px var(--shadow-medium);
    }

    button[type="submit"]:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px var(--shadow-medium);
    }

    button[type="submit"]:active {
      transform: scale(0.98);
    }

    #status {
      text-align: center;
      font-size: 0.9rem;
      font-weight: 500;
      margin-top: 10px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid transparent;
      transition: all 0.3s ease;
    }
    #status.success {
      background-color: var(--success-bg);
      color: var(--success-text);
      border-color: var(--success-border);
    }
    #status.error {
      background-color: var(--failure-bg);
      color: var(--failure-text);
      border-color: var(--failure-border);
    }

    .hidden {
      display: none !important;
    }

    /* Manter 2 colunas em telas menores também */
    @media (max-width: 550px) {
      .app {
        padding: 20px;
        gap: 15px;
      }
      h1 {
        font-size: 1.8rem;
      }
      .components {
        grid-template-columns: repeat(2, 1fr); /* Manter duas colunas mesmo em telas menores */
        gap: 10px; /* Ajuste o gap para telas menores se necessário */
      }
      .component {
        min-height: 80px; /* Altura ajustada para telas menores, ainda mantendo o aspecto quadrado */
        padding: 15px 10px;
      }
      .component .icon {
        font-size: 1.8rem; /* Ajuste para telas menores */
      }
      .component span {
        font-size: 0.9rem;
      }
      button[type="submit"] {
        font-size: 0.9rem;
        padding: 12px;
      }
      label, legend {
        font-size: 0.9rem;
      }
      select, input[type="text"] {
        padding: 10px;
      }
    }
  </style>
</head>
<body>

<div class="app">
  <h1>Registro de Testes de Componentes</h1>
  
  <form id="dataForm">

    <div class="field">
      <label for="modelo">Modelo</label>
      <select id="modelo" name="modelo" required>
        <option value="" disabled selected>Selecione o modelo</option>
        <option value="HF801">HF801</option>
        <option value="HF810">HF810</option>
        <option value="HF900">HF900</option>
        <option value="HF405">HF405</option>
        <option value="HF918">HF918</option>
      </select>
    </div>

    <div class="field hidden" id="clienteField">
      <label for="cliente">Cliente</label>
      <input type="text" id="cliente" name="cliente" placeholder="Nome do cliente" required />
    </div>

    <fieldset class="hidden" id="componentesField">
      <legend>Componentes</legend>
      <div class="components" id="components"></div>
    </fieldset>

    <button type="submit" class="hidden" id="enviarBtn">Enviar Teste</button>
  </form>

  <div id="status"></div>
</div>

<script>
  const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxVtY1ueaHb6qPed3wr64ts9guFpJgRIDNl_cRpfj7cKhtXjRw8I-E9Hspzx89xchFJdg/exec';

  const componentes = [
    { id: 'aht10', label: 'AHT10' },
    { id: 'botao_esquerdo', label: 'Botão Esquerdo' },
    { id: 'botao_direito', label: 'Botão Direito' },
    { id: 'botao_reset', label: 'Botão Reset' },
    { id: 'certificado', label: 'Certificado' },
    { id: 'conector_mola', label: 'Conector Mola' },
    { id: 'esp32', label: 'ESP32' },
    { id: 'display', label: 'Display' },
    { id: 'led_azul', label: 'LED Azul' },
    { id: 'ledrgb', label: 'LED RGB' },
    { id: 'ldr', label: 'LDR' },
    { id: 'ntc', label: 'NTC' },
    { id: 'relay', label: 'Relay' },
    { id: 'tm1637', label: 'TM1637' },
    { id: 'watchdog', label: 'Watchdog' },
    { id: 'botao_central', label: 'Botão Central' }
  ];

  // Mapeamento de ícones para cada estado usando classes do Font Awesome
  const statusIcons = {
    'N/A': 'fas fa-question', // Ícone de interrogação
    'OK': 'fas fa-check-circle', // Ícone de check
    'FALHA': 'fas fa-exclamation-triangle' // Ícone de exclamação/cuidado
  };

  const hideMap = {
    'HF801': ['aht10'],
    'HF810': ['aht10'],
    'HF900': ['aht10'],
    'HF405': ['aht10', 'ntc'],
    'HF918': ['ntc'] 
  };

  const modeloSelect = document.getElementById('modelo');
  const clienteField = document.getElementById('clienteField');
  const componentesField = document.getElementById('componentesField');
  const componentsDiv = document.getElementById('components');
  const enviarBtn = document.getElementById('enviarBtn');
  const form = document.getElementById('dataForm');
  const statusDiv = document.getElementById('status');

  modeloSelect.addEventListener('change', () => {
    const modelo = modeloSelect.value;

    clienteField.classList.remove('hidden');
    componentesField.classList.remove('hidden');
    enviarBtn.classList.remove('hidden');

    gerarComponentes(modelo);
  });

  function gerarComponentes(modelo) {
    componentsDiv.innerHTML = '';
    estadoComponentes = {};

    const toHide = hideMap[modelo] || [];

    componentes.forEach(comp => {
      if (!toHide.includes(comp.id)) {
        estadoComponentes[comp.id] = 'N/A'; // Estado inicial

        const div = document.createElement('div');
        div.classList.add('component', 'status-na'); // Começa com status N/A
        div.dataset.componentId = comp.id; // Armazena o ID do componente no elemento para fácil acesso

        const icon = document.createElement('i'); // Mudamos para <i> para os ícones do Font Awesome
        icon.classList.add('icon', ...statusIcons['N/A'].split(' ')); // Adiciona as classes do ícone inicial

        const nome = document.createElement('span');
        nome.textContent = comp.label;

        div.appendChild(icon);
        div.appendChild(nome);
        componentsDiv.appendChild(div);

        div.addEventListener('click', () => {
          let currentStatus = estadoComponentes[comp.id];
          let newStatus;

          // Lógica para alternar o status
          switch (currentStatus) {
            case 'N/A':
              newStatus = 'OK';
              break;
            case 'OK':
              newStatus = 'FALHA';
              break;
            case 'FALHA':
              newStatus = 'N/A';
              break;
            default:
              newStatus = 'N/A'; // Caso default para segurança
          }

          estadoComponentes[comp.id] = newStatus; // Atualiza o estado no objeto
          
          // Remove todas as classes de status e adiciona a nova
          div.classList.remove('status-na', 'status-ok', 'status-falha');
          div.classList.add(`status-${newStatus.toLowerCase()}`); // Adiciona a classe de status correspondente
          
          // Atualiza o ícone (remove as classes antigas e adiciona as novas do Font Awesome)
          icon.className = 'icon'; // Reseta as classes do ícone
          icon.classList.add(...statusIcons[newStatus].split(' ')); // Adiciona as novas classes
        });
      } else {
        estadoComponentes[comp.id] = 'N/A';
      }
    });
  }

  form.addEventListener('submit', e => {
    e.preventDefault();
    statusDiv.textContent = '';
    statusDiv.classList.remove('success', 'error');
    enviarBtn.disabled = true;

    const data = {
      modelo: form.modelo.value,
      cliente: form.cliente.value
    };

    for (let comp of componentes) {
      data[comp.id] = estadoComponentes[comp.id] || 'N/A';
    }

    data.data = new Date().toISOString();

    fetch(SCRIPT_URL, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    }).then(() => {
      statusDiv.classList.add('success');
      statusDiv.textContent = 'Dados enviados com sucesso!';

      form.reset();
      componentsDiv.innerHTML = '';
      clienteField.classList.add('hidden');
      componentesField.classList.add('hidden');
      enviarBtn.classList.add('hidden');
      estadoComponentes = {};
      enviarBtn.disabled = false;
    }).catch(err => {
      statusDiv.classList.add('error');
      statusDiv.textContent = 'Erro ao enviar os dados: ' + err.message;
      enviarBtn.disabled = false;
    });
  });
</script>
</body>
</html>
